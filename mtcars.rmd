---
title: "Influence of transmission type on miles per gallon"
fontsize: 11pt
geometry: margin=0.20in
output:
  pdf_document:
    fig_height: 3
    fig_width: 4
    latex_engine: xelatex
---
```{r,echo=F,eval=F}
require(datasets)
require(MASS)
```


This analysis addresses two questions about the Motor Trend Magazine 1973-1974 data on 32 different car models (mtcars dataset in R). Though the data contains many variables about different types of cars, this analysis is about:

-Is an automatic or manual transmission better for MPG (miles per gallon)  
-Quantifying the MPG difference between automatic and manual transmissions  

## Summary of analysis

A simple linear regression of "mpg" as an outcome against "am" (transmission type) is done and shows there appears to be a significant difference in "mpg" versus transmission type, with manual transmission appearing to get better mpg than automatic (at a p-value of less than 0.05).  

But there are many other variables in the data that may also have an effect on mpg, independant of transmission type.  So a multivariate regression is done in a both a step-wise forward and reverse fashion.   

## Exploratory analysis

Looking at the basic summary, dimensions and structure of the data set indicates there are 32 cars measured with 11 different variables.  The variables are all numbers by default, though some of these should be considered as factors because they fall into discrete categories.  I also take a look at the distirbution of mpg between two types of am (see Appendix, Figure 1). The two distributions are quite different, with medians far apart, which suggests a possible significant difference
between mpg of cars on automaticand manual transmission.


```{r, echo=FALSE, eval=FALSE}
summary(mtcars)
dim(mtcars)

```
```{r, echo=FALSE}
str(mtcars)
```
The first thing to do is to convert the discrete variables to factors.  These variables are cyl (number of cylinders), am (transmission type, 0 = automatic, 1 = manual), gear (number of forward gears), carb (number of carburetors), and vs.  

```{r, echo=FALSE, eval=FALSE}
mtcars$cyl=as.factor(mtcars$cyl)
mtcars$gear=as.factor(mtcars$gear)
mtcars$carb=as.factor(mtcars$carb)
mtcars$vs=as.factor(mtcars$vs)
mtcars$am = factor(mtcars$am, levels=c('0','1'),labels=c('Automatic','Manual'))
```


## Regression models

The first model I will explore is the simple linear model, model1=lm(mpg~am,mtcars).  This models shows that  cars with automatic transmission average around 17 mpg, and manual cars get around 7 mpg more (~24 mpg). The p-value for this difference is 0.000285, so is highly significant. However, the adjusted $R^2$ for this model is only 0.36, so the correlation between mpg and transmission type, though positive, is not very strong.  So it is worth looking for other variable also correlated with mpg to find the best predictors for the outcome mpg for for this data set.

```{r, echo=FALSE, eval=F}
model1=lm(mpg~am, mtcars)
summary(model1)

```

First I will use a forward step approach, starting with model1 and adding on new variables at a time. My criteria for keeping or discarding a new variable is based on the p-values generated by the additional variable.  If the new variable is not significant at p=0.05, or it's addition increases the p-value of the current variables to above p=0.05, I will discard it.  I will add the variables in the following order: cyl, disp,hp,drat,wt,qsec,vs,gear,carb.
```{r,echo=FALSE,eval=FALSE}
model2=lm(mpg~am+cyl,mtcars)#reject model as am becomes non-significant
summary(model2)
model3=lm(mpg~am+disp,mtcars)#reject model as am becomes non-significant
summary(model3)
model4=lm(mpg~am+hp,mtcars)#keep model hp as it is significant
summary(model4)
model5=lm(mpg~am+hp+drat,mtcars)#reject model as drat is not significant
summary(model5)
model5=lm(mpg~am+hp+wt,mtcars)#reject model as am becomes non-significant
summary(model5)
model6=lm(mpg~am+hp+qsec,mtcars)#reject model as qsec is not significant
summary(model6)
model7=lm(mpg~am+hp+vs,mtcars)#reject model as vs is not significant
summary(model7)
model8=lm(mpg~am+hp+gear,mtcars)#reject model as gear is not significant
summary(model8)
model9=lm(mpg~am+hp+carb,mtcars)#reject model as carb is not significant
summary(model9)
```

The model that fits best using this approach is lm(mpg~am+hp,mtcars), with an adjusted $R^2$ of 0.77.  Adding any additional variables was not productive.  However, looking at the collinearity of many the variables with eachother, it is clear that this is not the only "best" model, but it explains 77% of the variance in mpg.  Using a completely different approach, the stepAIC backwards step model (from the MASS package), I find the best model to be lm(mpg~cyl+hp+wt+am,mtcars). The selections for this model are based on and AIC score, or Akaike information criterion, rather than p-values. This gives us an adjusted $R^2$ of 0.84.  Thus this model appears to be better than lm(mpg~am+hp). This is my final model.
```{r,echo=F,eval=F}
model10=lm(mpg~.,mtcars)
model11=stepAIC(model10, direction="backward")
summary(model11)
```

## Confidence 
```{r,echo=F, eval=F}
model12=lm(mpg~am+cyl+hp+wt,mtcars)
summary(model12)
confint(model12)
```

Looking at the confidence intervals for the final model, we can say with 95% confidence:

1)An average 4 cylinder car with automatic transmission gets between 28 and 39 mpg.   
2)A similar car with manual transmission gets between 1 mpg less to 4.7 mpg more, so under this model transmission type is not quite a significant predictor of mpg.  
3)A 6 cylinder car reduces mpg by 0 to -6 mpg  
4)An 8 cylinder car gets between 2.5 more to 6.8 less mpg  
5)A car above average weight will get 0.7 to 4.3 less mpg.   

## Model diagnotics and conclusions

To verify my model is a good fit, I will check the residuals with plots (Appendix, Figure 2). The residuals versus fitted values appear to be evenly distributed around zero, the normal Q-Q plot indicates approximate normality of the standardised residuals against the theoretical ones, The Scale-Location plot again shows there is no strong trend in the residuals, and the residuals versus Leverage plot shows no outstanding leverage points. So the residuals appear fine, but the acid test is how good the model is at predicting mpg (Appendix, Figure 3).  The plot of actual mpg against predicted mpg is very good indeed, therefore this model seems a good fit for determining the effect of transmission type (controlled for the other variables in the model).  I also looked at my model based on p-values from step-forward selection to see how well it predicts mpg (Appendix, Figure 4).  This model also looks pretty good too.  So both approaches to model selection that I used appear to give me good prediction outcomes.  This is not a surprise given the large amount of collinearlity in the data variables.

Most of the code used to generate this document has been supressed for brevity.  The full code can however be found at 

\pagebreak




## Appendix

## Figure 1: Comparison of distributions between mpg of manual versus automatic transmission cars

```{r, fig.height=4,fig.width=4, echo=F}
boxplot(mtcars$mpg~mtcars$am,xlab="Transmission type", ylab="Miles per gallon")
```

## Figure 2: Residual diagnostic plots
```{r, fig.height=8, fig.width=8, echo=F}
par(mfrow=c(2,2))
model12=lm(mpg~am+cyl+hp+wt,mtcars)
plot(model12)
```

## Figure 3: MPG prediction from stepAIC backward method
```{r, fig.height=4, fig.width=4, echo=F}
model12=lm(mpg~am+cyl+hp+wt,mtcars)
predict1=predict(model12,mtcars,interval="prediction")
plot(predict1, xlab="Actual mpg", ylab="Predicted mpg")
```

## Figure 4: MPG prediction from p-value step forward method
```{r, fig.height=4, fig.width=4,echo=F}
model4=lm(mpg~am+hp,mtcars)
predict2=predict(model4,mtcars,interval="prediction")
plot(predict2, xlab="Actual mpg", ylab="Predicted mpg")
```

